<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SolusiYa - Find Free Help Near You</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    header {
      background: #014a63;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    form {
      padding: 1rem;
      background: #f2f2f2;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    form select, form button {
      padding: 0.5rem;
      font-size: 1rem;
    }
    #map {
      height: 80vh;
    }
    @media (max-width: 600px) {
      form {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>SolusiYa</h1>
    <p>Find free food, shelter, or health support near you</p>
    <select id="lang-select">
      <option value="en">English</option>
      <option value="es">EspaÃ±ol</option>
      <option value="pt">PortuguÃªs</option>
    </select>
  </header>

  <form id="helpForm">
    <select id="country">
      <option value="all">ðŸŒŽ All Countries</option>
      <option value="usa">ðŸ‡ºðŸ‡¸ USA</option>
      <option value="brazil">ðŸ‡§ðŸ‡· Brazil</option>
    </select>

    <select id="state" style="display:none;">
      <option value="all">All States</option>
      <option value="ny">New York</option>
      <option value="ca">California</option>
      <option value="fl">Florida</option>
    </select>

    <select id="type">
      <option value="all">All Help Types</option>
      <option value="food">Food</option>
      <option value="shelter">Shelter</option>
      <option value="medical">Medical</option>
    </select>

    <button type="submit">Find Help</button>
  </form>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([37.8, -96], 4);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    const helpCenters = [
      {
        name: "Red Cross NYC",
        address: "520 W 49th St, New York, NY",
        country: "usa",
        state: "ny",
        lat: 40.7653,
        lng: -73.9927,
        services: ["food", "shelter"]
      },
      {
        name: "Los Angeles Mission",
        address: "303 E 5th St, Los Angeles, CA",
        country: "usa",
        state: "ca",
        lat: 34.0446,
        lng: -118.2478,
        services: ["food", "shelter"]
      },
      {
        name: "Camillus House - Miami",
        address: "1603 NW 7th Ave, Miami, FL",
        country: "usa",
        state: "fl",
        lat: 25.7893,
        lng: -80.2082,
        services: ["food", "medical"]
      },
      {
        name: "SÃ£o Paulo Mission",
        address: "Av. Paulista, SÃ£o Paulo",
        country: "brazil",
        lat: -23.5614,
        lng: -46.6556,
        services: ["food", "shelter", "medical"]
      }
    ];

    const markers = [];

    function renderMarkers(data) {
      markers.forEach(m => map.removeLayer(m));
      data.forEach(loc => {
        const m = L.marker([loc.lat, loc.lng])
          .addTo(map)
          .bindPopup(`<strong>${loc.name}</strong><br>${loc.address}<br><em>${loc.services.join(', ')}</em>`);
        markers.push(m);
      });
    }

    function filterLocations(country, state, type) {
      return helpCenters.filter(loc => {
        const countryMatch = country === "all" || loc.country === country;
        const stateMatch = country !== "usa" || state === "all" || loc.state === state;
        const typeMatch = type === "all" || loc.services.includes(type);
        return countryMatch && stateMatch && typeMatch;
      });
    }

    document.getElementById('country').addEventListener('change', function () {
      const stateSelect = document.getElementById('state');
      if (this.value === 'usa') {
        stateSelect.style.display = 'inline-block';
      } else {
        stateSelect.style.display = 'none';
      }
    });

    document.getElementById('helpForm').addEventListener('submit', e => {
      e.preventDefault();
      const country = document.getElementById('country').value;
      const state = document.getElementById('state').value;
      const type = document.getElementById('type').value;
      const filtered = filterLocations(country, state, type);
      renderMarkers(filtered);
      if (filtered.length) {
        map.setView([filtered[0].lat, filtered[0].lng], 6);
      }
    });

    renderMarkers(helpCenters);
  </script>
</body>
</html>